<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Optimum cuts</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</head>
<style>
    hr.result {
        border: 1px solid #775c6a;
        margin-right: 70%;
    }

    div .sash {
        background-color: aliceblue;
    }

    input.graphics {
        height: 24px;
        width: 60px;
    }

    .barType {
        margin-left: 30%;
    }

    .top-buffer {
        margin-top: 10px;
    }

    /*
     BAR VISUALS
    */
    div.d90 {
        background-color: #ccc;
        border: 5px solid #ccc;
        height: 24px;
        position: relative;
        width: 100%;
    }

    div.d135l {
        content: '45';
        position: absolute;
        border: 12px solid #ccc;
        top: -5px;
        left: -5px;
        /*border-top: white;*/
        /*border-right: transparent;*/
        /*border-bottom: transparent;*/
        /*border-left: white;*/
        border-color: white transparent transparent white;
    }

    div.d135r {
        content: '45';
        position: absolute;
        right: -5px;
        top: -5px;
        border: 12px solid #ccc;
        /*border-color: #ccc transparent white transparent;*/
        border-right-color: white;
        border-top-color: white;
        border-bottom-color: transparent;
    }

    div.d45l {
        position: absolute;
        /*height: 15px;*/
        border: 12px solid #ccc;
        top: -5px;
        left: -5px;
        border-color: transparent transparent white white;
    }

    div.d45r {
        content: '45';
        position: absolute;
        right: -5px;
        top: -5px;
        border: 12px solid #ccc;
        /*border-color: #ccc transparent white transparent;*/
        border-right-color: white;
        border-top-color: #ccc;
        border-bottom-color: white;
    }
</style>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<script>
    const CLASS_NAME_NO = 'no_input_';
    const CLASS_NAME_LENGTH = 'length_input_';
    const BAR_LENGTH = 'bar_length';
    const CLASS_NAME_PROFILE_TYPE_LEFT = 'profile_type_left';
    const CLASS_NAME_PROFILE_TYPE_RIGHT = 'profile_type_right';
    const CLASS_NAME_PROFILE_CODE = 'profile_code';
    const CLASS_NAME_PROFILE_WIDTH = 'profile_width';
    const CLASS_NAME_PROFILE_HEIGHT = 'profile_height';
    const CLASS_NAME_PROFILE_COLOR = 'profile_color';
    const CLASS_NAME_PROFILE_MAT = 'profile_mat';
    const BAR_CUT_WASTE = 8;
    var inputs = 0;
    var door_inputs = 0;
    var globalLengths = [];
    const doorCodes = [];
    const PROFILE_MATERIALS = {
        DXF_2V: 'Profil 2 Vision.dxf',
        DXF_2V2019: 'Profil 2 Vision 2019.dxf',
        DXF_ALUTEC: 'Profil Alutec 18.5x32 standard.dxf',
        BAK_ECO: 'Profil ECO.bak',
        DXF_ECO: 'Profil ECO.dxf',
        DXF_H2V: 'Profil H 2 Vision.dxf',
        DXF_SIMAX: 'simax_aripa_cercevea.dxf',
        DXF_TOC_2V2019: 'Toc 2 Vision 2019.dxf',
        DXF_TOC_2V: 'Toc 2 Vision.dxf',
        DXF_TOC_SINGLEV2019: 'Toc Single VISION 2019.dxf',
        DXF_LEAF_PROFILE: 'Leaf profile GSW Office Plus.dxf',
        DXF_LUCE: 'luce.dxf',
        DXF_2V_BIGCERCEVEA: '2vision_big_cercevea.dxf',
    };
    const DOOR_TYPE = {
        SX: 'SX',
        DX:'DX'
    };
    const NO_SASH = 'Fara cercevea - USA STICLA';
    const DOORJAMBS = [
       PROFILE_MATERIALS.DXF_TOC_2V2019, PROFILE_MATERIALS.DXF_TOC_SINGLEV2019
    ];

    const DOORSASHS = [
        PROFILE_MATERIALS.DXF_2V_BIGCERCEVEA,
        NO_SASH
    ];

    const INPUT_TYPE = {
        DOOR: 'door_',
        CUSTOM: '_'
    };
    const doorDependencyGraph = {
        1: [4,5], //height
        2: [6,7], //width
        3: [4, 5] //height,
    };
    const doorjambDependency = {
        1: 3,
        3: 1
    };
    const WIDTH_DIFFERENCE = 79;
    const HEIGHT_DIFFERENCE_ON_RUG = 52;
    const RUG_LENGTH=7;
    var selectedDxfs =[];

    window.onload = (event) => {
        //append door jamb selection options
        DOORJAMBS.forEach(option => {
            $('#door_jamb_selection').append(`<option>${option}</option>`);
        });
         //append sash selection options
        DOORSASHS.forEach(option => {
            $('#door_sash_selection').append(`<option>${option}</option>`);
        });


    };

    function openLengthsModal() {

        $('#modal-body').innerHTML='';
        for(let i=1;i<=door_inputs;i++) {
            const dxf = $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${i}`)[0].value;
            if(!selectedDxfs[dxf]){
                $('#modal-body').append(`Lungime bara ${dxf}: <input class="door_bar_length _dxf${dxf}_dxf" type="text" onkeydown="return validate(event,this)"/> mm <br /><br />`);
            }
            selectedDxfs[dxf]=true;
        }
        $('#exampleModal').modal('show');
    }

    function changeProfileLengthValues(i,type, option) {
        switch (option) {
            case PROFILE_MATERIALS.DXF_LUCE:
                $(`.${CLASS_NAME_PROFILE_HEIGHT}${type}${i}`)[0].value = 60;
                $(`.${CLASS_NAME_PROFILE_WIDTH}${type}${i}`)[0].value = 47.6;
                break;
            case PROFILE_MATERIALS.DXF_TOC_SINGLEV2019:
                $(`.${CLASS_NAME_PROFILE_HEIGHT}${type}${i}`)[0].value = 50;
                $(`.${CLASS_NAME_PROFILE_WIDTH}${type}${i}`)[0].value = 55.2;
                break;
            case PROFILE_MATERIALS.DXF_2V:
            case PROFILE_MATERIALS.DXF_TOC_2V2019:
                $(`.${CLASS_NAME_PROFILE_HEIGHT}${type}${i}`)[0].value = 50;
                $(`.${CLASS_NAME_PROFILE_WIDTH}${type}${i}`)[0].value = 100;
                break;
            case PROFILE_MATERIALS.DXF_LEAF_PROFILE:
                $(`.${CLASS_NAME_PROFILE_HEIGHT}${type}${i}`)[0].value = 68;
                $(`.${CLASS_NAME_PROFILE_WIDTH}${type}${i}`)[0].value = 48;
                break;
            case PROFILE_MATERIALS.DXF_2V2019:
                $(`.${CLASS_NAME_PROFILE_HEIGHT}${type}${i}`)[0].value = 35;
                $(`.${CLASS_NAME_PROFILE_WIDTH}${type}${i}`)[0].value = 100;
                break;
            case PROFILE_MATERIALS.DXF_2V_BIGCERCEVEA:
                $(`.${CLASS_NAME_PROFILE_HEIGHT}${type}${i}`)[0].value = 62.9;
                $(`.${CLASS_NAME_PROFILE_WIDTH}${type}${i}`)[0].value = 47.6;
                break;
        }
    }

    function validate(event) {
        var keycode = (event.which) ? event.which : event.keyCode;

        if (keycode > 31 && ((keycode < 48 || keycode > 57) && (keycode < 96 || keycode > 105))) {
            alert(" You can enter only characters 0 to 9 ");
            return false;
        }
        return true;
    }

    function calculateResult() {
        let lengthsArr = [];
        //recreate array with all the lengths
        const barLength = parseInt($(`.${BAR_LENGTH}`)[0].value);
        for (var i = 1; i <= inputs; i++) {
            let length = parseInt($(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.CUSTOM}${i}`)[0].value);
            let noLengths = parseInt($(`.${CLASS_NAME_NO}${INPUT_TYPE.CUSTOM}${i}`)[0].value);
            let profileTypeL = $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.CUSTOM}${i}`)[0].value;
            let profileTypeR = $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.CUSTOM}${i}`)[0].value;
            let profileCode = $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.CUSTOM}${i}`)[0].value;
            let profileColor = $(`.${CLASS_NAME_PROFILE_COLOR}${INPUT_TYPE.CUSTOM}${i}`)[0].value;
            let profileWidth = $(`.${CLASS_NAME_PROFILE_WIDTH}${INPUT_TYPE.CUSTOM}${i}`)[0].value;
            let profileHeight = $(`.${CLASS_NAME_PROFILE_HEIGHT}${INPUT_TYPE.CUSTOM}${i}`)[0].value;
            let profileMat = $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.CUSTOM}${i}`)[0].value;

            if (!isNaN(noLengths) && !isNaN(length)) {
                lengthsArr.push({
                    length,
                    noLengths,
                    profileTypeL,
                    profileTypeR,
                    profileCode,
                    profileColor,
                    profileHeight,
                    profileWidth,
                    profileMat
                });
            }
        }
        lengthsArr = lengthsArr.sort((item1, item2) => {
            return -(item1.length - item2.length)
        });
        globalLengths = lengthsArr;
        let noBars = 0;
        let results = [];
        while (lengthsArr.length !== 0) {
            noBars++;
            let barRest = barLength;
            let barResultingPieces = [];
            lengthsArr.forEach(({
                                    length,
                                    noLengths,
                                    profileTypeL,
                                    profileTypeR,
                                    profileCode,
                                    profileColor,
                                    profileHeight,
                                    profileWidth,
                                    profileMat
                                }, index) => {
                let cutsMade = 0;
                let potentialCuts = parseInt(barRest / (length + BAR_CUT_WASTE));
                potentialCuts = potentialCuts <= noLengths
                    ? potentialCuts
                    : noLengths;
                barRest -= potentialCuts * (length + BAR_CUT_WASTE);
                lengthsArr[index].noLengths -= potentialCuts;
                cutsMade = potentialCuts;
                if ((potentialCuts < noLengths)   //poate mai putem adauga o bucata in plus eliminand ultima portiune de 8 mm
                    && (barRest - length) >= 0) {
                    barRest -= length;
                    lengthsArr[index].noLengths--;
                    cutsMade++;
                }
                if (cutsMade > 0) {
                    barResultingPieces.push({
                        nrPieces: cutsMade,
                        lengthPieces: length,
                        profileTypeL,
                        profileTypeR,
                        profileCode,
                        profileColor,
                        profileWidth,
                        profileHeight,
                        profileMat,
                    });
                }
            }, lengthsArr)
            results.push({barRest, barResultingPieces});
            lengthsArr = lengthsArr.filter((value, index, array) => {
                return (value.noLengths !== 0);
            });
        }
        buildDataTable(results, barLength);
        showResults(results, barLength);
        globalResults = results;
    }

    function calculateDoorResult() {
        $('#exampleModal').modal('hide');
        deletePreviousDoorRows();
        let lengthObjArr = {};
        //add doors
        for (var i = 1; i <= door_inputs; i++) {
            let length = parseInt($(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${i}`)[0].value);
            let noLengths = parseInt($(`.${CLASS_NAME_NO}${INPUT_TYPE.DOOR}${i}`)[0].value);
            let profileTypeL = $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${i}`)[0].value;
            let profileTypeR = $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${i}`)[0].value;
            let profileCode = $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.DOOR}${i}`)[0].value;
            let profileColor = $(`.${CLASS_NAME_PROFILE_COLOR}${INPUT_TYPE.DOOR}${i}`)[0].value;
            let profileWidth = $(`.${CLASS_NAME_PROFILE_WIDTH}${INPUT_TYPE.DOOR}${i}`)[0].value;
            let profileHeight = $(`.${CLASS_NAME_PROFILE_HEIGHT}${INPUT_TYPE.DOOR}${i}`)[0].value;
            let profileMat = $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${i}`)[0].value;

            if (!isNaN(noLengths) && !isNaN(length)) {
                if(!lengthObjArr[profileMat]) lengthObjArr[profileMat] = [];
                lengthObjArr[profileMat].push({
                    length,
                    noLengths,
                    profileTypeL,
                    profileTypeR,
                    profileCode,
                    profileColor,
                    profileHeight,
                    profileWidth,
                    profileMat
                });
            }
        }

        let results= [];
        let barsLengths = [];
        $(`.door_bar_length`).toArray().forEach(input => {
            barsLengths.push( {barLength: Number(input.value), profileMat: input.className.split('_dxf')[1] });
        });

        for(let barLengthObject of barsLengths) {
            results = [];
            let lengthsArr = lengthObjArr[barLengthObject.profileMat].sort((item1, item2) => {
                return -(item1.barLength - item2.barLength)
            });
            while (lengthsArr.length !== 0) {
                let barRest = barLengthObject.barLength;
                let barResultingPieces = [];
                lengthsArr.forEach(({
                                        length,
                                        noLengths,
                                        profileTypeL,
                                        profileTypeR,
                                        profileCode,
                                        profileColor,
                                        profileHeight,
                                        profileWidth,
                                        profileMat
                                    }, index) => {
                    let cutsMade = 0;
                    let potentialCuts = parseInt(barRest / (length + BAR_CUT_WASTE));
                    potentialCuts = potentialCuts <= noLengths
                        ? potentialCuts
                        : noLengths;
                    barRest -= potentialCuts * (length + BAR_CUT_WASTE);
                    lengthsArr[index].noLengths -= potentialCuts;
                    cutsMade = potentialCuts;
                    if ((potentialCuts < noLengths)   //poate mai putem adauga o bucata in plus eliminand ultima portiune de 8 mm
                        && (barRest - length) >= 0) {
                        barRest -= length;
                        lengthsArr[index].noLengths--;
                        cutsMade++;
                    }
                    if (cutsMade > 0) {
                        barResultingPieces.push({
                            nrPieces: cutsMade,
                            lengthPieces: length,
                            profileTypeL,
                            profileTypeR,
                            profileCode,
                            profileColor,
                            profileWidth,
                            profileHeight,
                            profileMat,
                        });
                    }
                }, lengthsArr)
                results.push({barRest, barResultingPieces});
                lengthsArr = lengthsArr.filter((value, index, array) => {
                    return (value.noLengths !== 0);
                });
            };
            showDoorResults(results, barLengthObject.barLength, barLengthObject.profileMat);
            buildDataTable(results, barLengthObject.barLength, 'datatable-door', false);
        }
        location.hash = "#door-results";
    }

    function deletePreviousDoorRows() {
        $(`table tr.datatable-door`).remove();
        $('#door-results').empty();
    }

    function buildDataTable(results, barLength, datatable='datatable', shouldDeletePreviousRows= true) {
        const table = document.getElementById('datatable');
        // while (table.rows.length > 1) {
        //     table.deleteRow(1);
        // }
        shouldDeletePreviousRows && $(`table tr.${datatable}`).remove();
        let i = 1;
        let bars = [];
        const convertAngle = (angle) => {
            if (Number(angle) === 90) return angle;
            if (angle < 90) return 135;
            return 45;
        };
        bars = results.map(result => result.barResultingPieces).flat();
        bars.forEach(bar => {
            const row = table.insertRow(i);
            row.className = datatable;
            row.insertCell(0).innerText = '1';
            row.insertCell(1).innerText = (new Date()).getFullYear();
            row.insertCell(2).innerText = $('#project_name').val();
            row.insertCell(3).innerText = bar.profileMat;
            row.insertCell(4).innerText = bar.profileColor;
            row.insertCell(5).innerText = bar.profileColor;
            row.insertCell(6).innerText = bar.profileMat;
            row.insertCell(7).innerText = bar.profileHeight;
            row.insertCell(8).innerText = bar.profileWidth;
            row.insertCell(9).innerText = '0';
            row.insertCell(10).innerText = 'WWW.OMIFA.RO';
            row.insertCell(11).innerText = '';
            row.insertCell(12).innerText = barLength;
            row.insertCell(13).innerText = bar.nrPieces;
            row.insertCell(14).innerText =  datatable === 'datatable-door' ? doorCodes[bar.profileCode] : bar.profileCode;
            row.insertCell(15).innerText = bar.lengthPieces;
            row.insertCell(16).innerText = convertAngle(bar.profileTypeL);
            row.insertCell(17).innerText = convertAngle(bar.profileTypeR);
            row.insertCell(18).innerText = '';
            row.insertCell(19).innerText = '';
            row.insertCell(20).innerText = '';
            row.insertCell(21).innerText = datatable === 'datatable-door' ? bar.profileCode.replace('_'+doorCodes[bar.profileCode], "") : bar.profileCode;
            row.insertCell(22).innerText = 'OMIFA';
            row.insertCell(23).innerText = '';
            row.insertCell(24).innerText = '';
            i++;
        })

    }

    function addDoor(doorType, isOnRug = false) {
        //fetch values
        const doorWidth = Number($('#door_width')[0].value);
        const doorHeight = Number($('#door_height')[0].value);
        const doorCode = $('#door_code')[0].value;
        const doorPieces = Number($('#door_pieces')[0].value);
        const doorJambSelectionValue = $('#door_jamb_selection')[0].value;
        const doorSashSelectionValue = $('#door_sash_selection')[0].value;
        //add profiles
        addDoorJamb(doorType, isOnRug, doorJambSelectionValue, doorHeight, doorWidth, doorCode,  doorPieces);
        if(doorSashSelectionValue !== NO_SASH) {
            addSash(doorType, isOnRug, doorWidth, doorHeight, doorCode, doorPieces);
        }
    }
    
    function addSash(doorType = DOOR_TYPE.DX, isOnRug = false, doorWidth, doorHeight, doorCode, amount=1) {
        const sashParts = [
            {
                name: doorType === DOOR_TYPE.DX ? 'iala' : 'balama',
                length: doorHeight - HEIGHT_DIFFERENCE_ON_RUG - (isOnRug ? 0 : RUG_LENGTH)
            }, {
                name: doorType === DOOR_TYPE.DX ? 'balama' : 'iala',
                length: doorHeight - HEIGHT_DIFFERENCE_ON_RUG - (isOnRug ? 0 : RUG_LENGTH)
            }, {
                name: doorType === DOOR_TYPE.DX ? 'superioara' : 'inferioara',
                length: doorWidth - WIDTH_DIFFERENCE
            }, {
                name: doorType === DOOR_TYPE.DX ? 'inferioara' : 'superioara',
                length: doorHeight - WIDTH_DIFFERENCE
            },
        ]
        sashParts.map(({length, name}, i) => {
            const profileI = ++door_inputs;
            const profileHtml = `<div class="sash"}>${getInput(INPUT_TYPE.DOOR,door_inputs)}</div>`;
            $("#door-pieces").append(profileHtml);
            //precompletion
            //select
            $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${profileI}`)[0].value = PROFILE_MATERIALS.DXF_2V_BIGCERCEVEA;
            changeProfileLengthValues(profileI, INPUT_TYPE.DOOR, PROFILE_MATERIALS.DXF_2V_BIGCERCEVEA);
            //left angle
            $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${profileI}`)[0].value = 45;
            //right angle
            $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${profileI}`)[0].value = 45;
            //name
            const code = `${doorType}_cercevea_${name}_${doorCode}`;
            $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.DOOR}${profileI}`)[0].value = code;
            doorCodes[code] = doorCode;
            //length
            $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${profileI}`)[0].value= length;
            //amount--number of pieces
            $(`.${CLASS_NAME_NO}${INPUT_TYPE.DOOR}${profileI}`)[0].value= amount;

            //disable
            //select
            $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${profileI}`)[0].disabled  = true;
            //left angle
            $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${profileI}`)[0].disabled = true;
            //right angle
            $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${profileI}`)[0].disabled = true;
            //length
            $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${profileI}`)[0].disabled=true;
        });
    }
    function addDoorJamb(doorType, isOnRug, profileDXF, doorHeight, doorWidth, doorCode, amount=1) {
        const lockI = (++door_inputs);
        var lockHtml = getInput(INPUT_TYPE.DOOR, door_inputs);
        const supPartI = (++door_inputs);
        var supPartHtml = getInput(INPUT_TYPE.DOOR, door_inputs);
        const hingeI = (++door_inputs);
        var hingeHtml = getInput(INPUT_TYPE.DOOR, door_inputs);
        $("#door-pieces").append(lockHtml);
        $("#door-pieces").append(supPartHtml);
        $("#door-pieces").append(hingeHtml);
        //precompletion
        //select
        $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${lockI}`)[0].value = profileDXF;
        $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${supPartI}`)[0].value = profileDXF;
        $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${hingeI}`)[0].value = profileDXF;
        changeProfileLengthValues(lockI, INPUT_TYPE.DOOR, profileDXF);
        changeProfileLengthValues(supPartI, INPUT_TYPE.DOOR, profileDXF);
        changeProfileLengthValues(hingeI, INPUT_TYPE.DOOR, profileDXF);
        //left angle
        $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${lockI}`)[0].value = 45;
        $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${supPartI}`)[0].value = 45;
        $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${hingeI}`)[0].value = 90;
        //right angle
        $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${lockI}`)[0].value = 90;
        $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${supPartI}`)[0].value = 45;
        $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${hingeI}`)[0].value = 45;
        // doorCodes
        const code1 =  `${doorType}_${doorType === DOOR_TYPE.DX? 'iala' : 'balama'}_${doorCode}`;
        const code2 =  `${doorType}_partea_superioara_${doorCode}`;
        const code3 =  `${doorType}_${doorType === DOOR_TYPE.DX? 'balama' : 'iala'}_${doorCode}`;
        doorCodes[code1] = doorCode;
        doorCodes[code2] = doorCode;
        doorCodes[code3] = doorCode;
        //names
        $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.DOOR}${lockI}`)[0].value = code1;
        $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.DOOR}${supPartI}`)[0].value = code2;
        $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.DOOR}${hingeI}`)[0].value = code3;

        //length
        $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${lockI}`)[0].value= doorHeight;
        $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${supPartI}`)[0].value = doorWidth;
        $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${hingeI}`)[0].value=  doorHeight;

        //amount -- number of pieces
        $(`.${CLASS_NAME_NO}${INPUT_TYPE.DOOR}${lockI}`)[0].value= amount;
        $(`.${CLASS_NAME_NO}${INPUT_TYPE.DOOR}${supPartI}`)[0].value = amount;
        $(`.${CLASS_NAME_NO}${INPUT_TYPE.DOOR}${hingeI}`)[0].value=  amount;

        //add event listener
        // $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${lockI}`)[0].addEventListener('input', doorjambValueChange);
        // $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${supPartI}`)[0].addEventListener('input', doorjambValueChange);
        // $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${hingeI}`)[0].addEventListener('input', doorjambValueChange);
        //disable
        //select
        $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${lockI}`)[0].disabled  = true;
        $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${supPartI}`)[0].disabled = true;
        $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.DOOR}${hingeI}`)[0].disabled = true;
        //left angle
        $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${lockI}`)[0].disabled = true;
        $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${supPartI}`)[0].disabled = true;
        $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.DOOR}${hingeI}`)[0].disabled = true;
        //right angle
        $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${lockI}`)[0].disabled = true;
        $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${supPartI}`)[0].disabled = true;
        $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.DOOR}${hingeI}`)[0].disabled = true;
        // profile length
        $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${lockI}`)[0].disabled= true;
        $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${supPartI}`)[0].disabled=true;
        $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${hingeI}`)[0].disabled= true;
    }

    function doorjambValueChange(e) {
        const profileIndex = parseInt(e.target.className.split('_').slice(-1)[0]);
        const profileBatch = parseInt(profileIndex/7)+1;
        const newValue = e.target.value;
        doorDependencyGraph[profileIndex%7].forEach(i => {
                $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${7*(profileBatch-1)+i}`)[0].value = newValue - (profileIndex == 2 ? WIDTH_DIFFERENCE : HEIGHT_DIFFERENCE_ON_RUG);
        });
        //additional height update
        const similarProfileIndex = doorjambDependency[profileIndex%7];
        if(similarProfileIndex){
            $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.DOOR}${7*(profileBatch-1) + similarProfileIndex}`)[0].value = newValue;
        }
    }

    function showResults(resultsArray, barLength) {
        let text = `Bari de ${barLength} necesare: <b>${resultsArray.length}</b> <br />`;
        $('#results').empty().append(text);
        text = ``;
        resultsArray.forEach((resultItem, index) => {
            text += `<hr class="result">`
            text += `Bara ${index + 1}:<ul>`;
            resultItem.barResultingPieces.forEach(({
                                                       nrPieces,
                                                       lengthPieces,
                                                       profileTypeL,
                                                       profileTypeR,
                                                       profileCode
                                                   }) => {
                let type = nrPieces === 1 ? `bucata` : `bucati`;
                text += `<li>${nrPieces} ${type} de ${lengthPieces} mm | ${profileTypeL} ---- ${profileTypeR} | ${profileCode} </li> `;
            });
            text += `</ul>`;
            text += `Ramas din bara: ${resultItem.barRest} <br />`;
        });

        $('#results').append(text);
    }

    function showDoorResults(resultsArray, barLength, barMat) {
        let text = `Bari de ${barLength} / <b> ${barMat}</b> necesare: <b>${resultsArray.length}</b><br />`;
        $('#door-results').append(text);
        text = ``;
        resultsArray.forEach((resultItem, index) => {
            text += `<hr class="result">`
            text += `Bara ${index + 1}:<ul>`;
            resultItem.barResultingPieces.forEach(({
                                                       nrPieces,
                                                       lengthPieces,
                                                       profileTypeL,
                                                       profileTypeR,
                                                       profileCode
                                                   }) => {
                let type = nrPieces === 1 ? `bucata` : `bucati`;
                text += `<li>${nrPieces} ${type} de ${lengthPieces} mm | ${profileTypeL} ---- ${profileTypeR} | ${profileCode} </li> `;
            });
            text += `</ul>`;
            text += `Ramas din bara: ${resultItem.barRest} <br /> <hr>`;
        });

        $('#door-results').append(text);
    }

    function getInput (profileType, inputs) {
        const functionInputs = inputs;
        var classNameNo = `${CLASS_NAME_NO}${profileType}${inputs}`;
        var classNameLength = `${CLASS_NAME_LENGTH}${profileType}${inputs}`;
        var profileTypeOptions =
            `<option value="90">90</option>
             <option value="45">45</option>
             <option value="135">135</option>
            `;
        var dxfOptions = `
            <option value="Profil 2 Vision.dxf">Profil 2 Vision.dxf</option>
            <option value="Profil Alutec 18.5x32 standard.dxf">Profil Alutec 18.5x32 standard.dxf</option>
            <option value="Profil ECO.bak">Profil ECO.bak</option>
            <option value="Profil ECO.dxf">Profil ECO.dxf</option>
            <option value="Profil H 2 Vision.dxf">Profil H 2 Vision.dxf</option>
            <option value="simax_aripa_cercevea.dxf">simax_aripa_cercevea.dxf</option>
            <option value="Toc 2 Vision 2019.dxf">Toc 2 Vision 2019.dxf</option>
            <option value="Toc 2 Vision.dxf">Toc 2 Vision.dxf</option>
            <option value="Toc Single VISION 2019.dxf">Toc Single VISION 2019.dxf</option>
            <option value="Leaf profile GSW Office Plus.dxf">Leaf profile GSW Office Plus.dxf</option>
            <option value="luce.dxf">luce.dxf</option>
            <option value="Profil 2 Vision 2019.dxf">Profil 2 Vision 2019.dxf</option>
            <option value="2vision_big_cercevea.dxf">2vision_big_cercevea.dxf</option>
        `
        var pieceInput =
            `
             <table>
             <tr>
                <th>Cod profil</th>
             </tr>
             <tr>
                <td><input class="${CLASS_NAME_PROFILE_CODE}${profileType}${inputs}" type="text" size="100" onClick="this.select();" /></td>
             </tr>
            </table>
            <table>
            <tr>
            <th>Culoare</th>
                <th>Inaltime</th>
                <th>Latime</th>
                <th>Material (dxf)</th>
            </tr>
            <tr>
              <td><input class="${CLASS_NAME_PROFILE_COLOR}${profileType}${inputs}" type="text"  value="anodizat" id="color" onClick="this.select();"/></td>
                <td><input class="${CLASS_NAME_PROFILE_HEIGHT}${profileType}${inputs}" type="text" id="height" onClick="this.select();"/></td>
                <td><input class="${CLASS_NAME_PROFILE_WIDTH}${profileType}${inputs}" type="text"  id="width" onClick="this.select();"/></td>
                <td>
                    <input type="text" name="mat" list="mat_names" onchange="changeProfileLengthValues( ${functionInputs}, '${profileType}', this.value)" class="${CLASS_NAME_PROFILE_MAT}${profileType}${inputs} ${CLASS_NAME_PROFILE_MAT}">
                    <datalist id="mat_names"  >${dxfOptions}</datalist>
                </td>
            </tr>
            </table>
             <br />
             <input class="${classNameNo}" onClick="this.select();" type="text" value="1" onkeydown="return validate(event, this)" name="pieceNr"/>
                bucati de
                <select id="profileTypeLeft${inputs}" name="profileTypeLeft" class="${CLASS_NAME_PROFILE_TYPE_LEFT}${profileType}${inputs} ">${profileTypeOptions}</select>
                -----
             <select id="profileTypeRight${inputs}" name="profileTypeRight" class="${CLASS_NAME_PROFILE_TYPE_RIGHT}${profileType}${inputs}">${profileTypeOptions}</select>
             |
             <input class="${classNameLength}" type="text" onkeydown="return validate(event, this)" onClick="this.select();" name="pieceLength"/> mm
            <hr> `;

        return pieceInput;
    }
    function addInput() {
        inputs++;
        const inputHtml = getInput(INPUT_TYPE.CUSTOM, inputs);
        $("#pieces").append(inputHtml);
        if (inputs > 1) { //precomplete the inputs (material, height, width, color)
            //selected material
            var currentSelect = $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.CUSTOM}${inputs}`)[0];
            var previousSelect = $(`.${CLASS_NAME_PROFILE_MAT}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0];
            currentSelect.value = previousSelect.value;
            //color
            $(`.${CLASS_NAME_PROFILE_COLOR}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_PROFILE_COLOR}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //height
            $(`.${CLASS_NAME_PROFILE_HEIGHT}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_PROFILE_HEIGHT}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //width
            $(`.${CLASS_NAME_PROFILE_WIDTH}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_PROFILE_WIDTH}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //profile name
            $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_PROFILE_CODE}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //left angle
            $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_PROFILE_TYPE_LEFT}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //right angle
            $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_PROFILE_TYPE_RIGHT}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //number of pieces
            $(`.${CLASS_NAME_NO}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_NO}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
            //number of pieces
            $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.CUSTOM}${inputs}`)[0].value = $(`.${CLASS_NAME_LENGTH}${INPUT_TYPE.CUSTOM}${inputs - 1}`)[0].value;
        }
    }

    function exportToExcel() {
        var elt = document.getElementById('datatable');
        var wb = XLSX.utils.table_to_book(elt, {sheet: "Sheet1"});
        return XLSX.writeFile(wb, 'clp_csv_cutting_list_example.xls');
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<div class="row">
    <div class="col-6">
        <label for="project_name">Nume proiect</label>
        <u><a style="cursor: pointer; color: blue" onclick="exportToExcel()" onmouseover="">Export to Excel</a></u>
        <br/>
        <textarea name="Text1" cols="60" rows="5" , id="project_name"></textarea>
        <br/> <br/>
        <i>*Nota: </i> Lamele taie 8 mm din teava
    </div>
    <div class="col-3">
        <img src="https://raw.githubusercontent.com/andreea96/calculator/master/cap_stanga.png" alt="Capat stanga">
    </div>
    <div class="col-3">
        <img src="https://raw.githubusercontent.com/andreea96/calculator/master/cap_dreapta.png" alt="Capat dreapta">
    </div>
</div>
<br/>
<div class="row">
    <div class="col-6">

    </div>
<div class="col-6">

</div>
</div>
<!--test-->
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true"><b>Profile custom</b></button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false"><b>USI</b></button>
    </li>

</ul>
<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <br /><br />
<!--        profile custom-->
        <label for="length">Lungime bara</label>
        <input class="bar_length" type="text" onkeydown="return validate(event,this)"/> mm
        <br/> <br/>
        <button onclick="calculateResult()">Calculeaza rezultat</button> &nbsp; &nbsp;
        <button onclick="addInput()" >Adauga bucati dorite</button>
        <br /><br />
        <div class ="row" >
            <div id="pieces" class="col-12"></div>
        </div>
        <div class="row">
            <div class="col-6" id="results">

            </div>
        </div>
<!--        END profile custom-->
    </div>
    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
        <br />
<!--        profile usi-->
        <button onclick="openLengthsModal()">Calculeaza rezultat</button>
        <br/> <br/>
        <table style="background-color: indianred">
            <tr>
                <th>Bucati</th>
                <th>Cod usa</th>
                <th>Latime usa</th>
                <th>Inaltime usa</th>
                <th>Toc</th>
                <th>Cercevea</th>
            </tr>
            <tr>
                <td><input id="door_pieces" type="text"  value="1" onClick="this.select();"/></td>
                <td><input id="door_code" type="text" onClick="this.select();"/></td>
                <td><input id="door_width" type="text" onClick="this.select();"/></td>
                <td><input id="door_height" type="text" onClick="this.select();"/></td>
                <td><select id="door_jamb_selection" type="text"></select></td>
                <td><select id="door_sash_selection"></select></td>
                <td>
                    <button class=" dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                        Adauga usa
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#" onclick="addDoor(DOOR_TYPE.DX)">DX -->pe <b>pardoseala</b></a>
                        <a class="dropdown-item" href="#" onclick="addDoor(DOOR_TYPE.DX, true)">DX -->pe <b>mocheta</b></a>
                        <a class="dropdown-item" href="#" onclick="addDoor(DOOR_TYPE.SX)">SX --> pe <b>mocheta</b></a>
                        <a class="dropdown-item" href="#" onclick="addDoor(DOOR_TYPE.SX, true)">SX -->pe <b>pardoseala</b></a>
                    </div>
                </td>
            </tr>
            <tr>
                <td>&nbsp; </td>
                <td>&nbsp; </td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </table>
        <br />
        <div id="door-pieces"></div>
        <div id="door-results"></div>
    </div>
</div>
<!--end test-->
<table id="datatable" style="display:none">
    <tr>
        <td> job_id</td>
        <td> job_year</td>
        <td> job_name</td>
        <td> mat_name</td>
        <td> mat_color_internal</td>
        <td> mat_color_external</td>
        <td> mat_image</td>
        <td> mat_profile_height</td>
        <td> mat_profile_width</td>
        <td> bar_id</td>
        <td> bar_idcode</td>
        <td> bar_count</td>
        <td> bar_length</td>
        <td> cut_pieces</td>
        <td> cut_idcode</td>
        <td> cut_length</td>
        <td> cut_leftangle</td>
        <td> cut_rightangle</td>
        <td> cut_compound_leftangle</td>
        <td> cut_compund_rightangle_saw</td>
        <td> cut_label_file</td>
        <td> cut_label_value1</td>
        <td> cut_label_value2</td>
        <td> cut_label_value3</td>
        <td> cut_label_value4</td>
    </tr>

</table>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Lungimi bari</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="calculateDoorResult()">Calculeaza rezultat</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>