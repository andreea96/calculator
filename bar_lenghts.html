<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Optimum cuts</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<style>
    hr.result{
        border: 1px solid #775c6a;
        margin-right: 70%;
    }
</style>
<body>
<script>
    const CLASS_NAME_NO= 'no_input_';
    const CLASS_NAME_LENGTH= 'length_input_';
    const BAR_LENGTH= 'bar_length';
    const BAR_CUT_WASTE = 8;
    var inputs = 0;
    function validate(event){
        var keycode = (event.which) ? event.which : event.keyCode;

        if (keycode > 31 && ((keycode < 48 || keycode > 57 ) && (keycode < 96 || keycode > 105))) {
            alert(" You can enter only characters 0 to 9 ");
            return false;
        }
        return true;
    }

    function calculateResult(){
        let lengthsArr = [];
        //recreate array with all the lengths
        const barLength = parseInt($(`.${BAR_LENGTH}`)[0].value);
        for(var i=1; i<=inputs; i++) {
            let length = parseInt($(`.${CLASS_NAME_LENGTH}${i}`)[0].value);
            let noLengths = parseInt($(`.${CLASS_NAME_NO}${i}`)[0].value);
            if(!isNaN(noLengths) && !isNaN(length)){
                lengthsArr.push({length, noLengths});
            }
        }
        lengthsArr = lengthsArr.sort((item1, item2) => {
            return -(item1.length - item2.length)
        });
        let noBars = 0;
        let results = [];
        while(lengthsArr.length !== 0) {
            noBars++;
            let barRest = barLength;
            let barResultingPieces = [];
            lengthsArr.forEach(({length, noLengths}, index) => {
                let cutsMade = 0;
                let potentialCuts = parseInt(barRest/(length+BAR_CUT_WASTE));
                potentialCuts = potentialCuts <= noLengths
                    ? potentialCuts
                    : noLengths;
                barRest-=potentialCuts*(length+BAR_CUT_WASTE);
                lengthsArr[index].noLengths -= potentialCuts;
                cutsMade = potentialCuts;
                if((potentialCuts < noLengths)   //poate mai putem adauga o bucata in plus eliminand ultima portiune de 8 mm
                    &&(barRest - length) >= 0 ) {
                      barRest -=length;
                      lengthsArr[index].noLengths--;
                      cutsMade++;
                }
                if(cutsMade > 0 ) {
                    barResultingPieces.push({
                        nrPieces: cutsMade,
                        lengthPieces: length
                    });
                }
            }, lengthsArr)
            results.push({barRest, barResultingPieces});
            lengthsArr = lengthsArr.filter((value, index, array) => {
                return (value.noLengths !== 0);
            });
        }
        showResults(results, barLength);
    }

    function showResults(resultsArray, barLength) {
        let text = `Bari de ${barLength} necesare: <b>${resultsArray.length}</b> <br />`;
        $('#results').empty().append(text);
        text = ``;
        resultsArray.forEach((resultItem, index) => {
            text +=`<hr class="result">`
            text+= `Bara ${index+1}:<ul>`;
            resultItem.barResultingPieces.forEach(({nrPieces, lengthPieces}) => {
                let type = nrPieces === 1 ? `bucata` : `bucati`;
                text+= `<li>${nrPieces} ${type} de ${lengthPieces} mm</li>`;
            });
            text+=`</ul>`;
            text+=`Ramas din bara: ${resultItem.barRest} <br />`;
        });

        $('#results').append(text);
    }

    function addInput() {
        inputs++;
        var classNameNo = `${CLASS_NAME_NO}${inputs}`;
        var classNameLength = `${CLASS_NAME_LENGTH}${inputs}`;
        var pieceInput =
            `<input class="${classNameNo}" type="text" onkeydown="return validate(event, this)" name="pieceNr"/>
                bucati de
                <input class="${classNameLength}" type="text" onkeydown="return validate(event, this)" name="pieceLength"/> mm
            <hr> `;
        $("#pieces").append(pieceInput);
    }

</script>
<label for="length">Lungime bara</label>
<input class="bar_length"   type="text" onkeydown="return validate(event,this)"  /> mm
<br /> <br />
<i>*Nota: </i> Lamele taie 8 mm din teava
<br />
<hr>
<div id="pieces">

</div>
<button onclick="calculateResult()">Calculeaza rezultat</button> &nbsp; &nbsp;
<button onclick="addInput()">Adauga bucati dorite</button>

<br />
<div id="results">

</div>
</body>
</html>